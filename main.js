import {Telegraf} from 'telegraf';
import moment from 'moment';
import gm from 'gm';
import {CronJob} from 'cron';
import http from 'http';
import path from "path";

const __dirname = process.cwd();

const bot = new Telegraf(process.env.BOT_TOKEN);

const chatId = 'blin_blinski_ng';

function declOfNum(n, text_forms) {
    n = Math.abs(n) % 100;
    var n1 = n % 10;
    if (n > 10 && n < 20) {
        return text_forms[2];
    }
    if (n1 > 1 && n1 < 5) {
        return text_forms[1];
    }
    if (n1 === 1) {
        return text_forms[0];
    }
    return text_forms[2];
}

const textsOfKuzya = [
    'ÐŸÐ¾Ñ‚ÐµÑ€Ñ Ð¿Ð¾Ñ‚ÐµÑ€ÑŒ!',
    'Ð‘Ð»Ð¸Ð½ Ð±Ð»Ð¸Ð½ÑÐºÐ¸Ð¹!',
    'Ð­Ñ‚Ð¾ Ð¿Ð¾Ð´ÑÑ‚Ð°Ð²Ð° Ð¿Ð¾Ð´ÑÑ‚Ð°Ð²!',
    'Ð Ñƒ Ñ‚ÐµÐ±Ñ ÐºÐ»ÑŽÐ² Ð²Ð¼ÐµÑÑ‚Ð¾ Ð½Ð¾ÑÐ°!',
    'ÐœÐµÐ½Ñ Ð·Ð¾Ð²ÑƒÑ‚ MC ÐšÑƒÐ·Ñ, Ð¼Ð¾Ð¹ Ñ€ÑÐ¿ Ð·Ð²ÑƒÑ‡Ð¸Ñ‚ ÐºÐ°Ðº Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚ UZI!',
    'Ð¡Ð¸Ð»ÑŒÐ²ÐµÑÑ‚Ñ€ ÐÐ½Ð´Ñ€ÐµÐµÐ²Ð¸Ñ‡, Ð²Ñ‹ Ñ‚Ð°ÐºÐ¾Ð¹ ÑƒÐ¼Ð½Ñ‹Ð¹. ÐÐµ Ð·Ñ€Ñ Ñƒ Ð²Ð°Ñ Ð»Ð¾Ð± Ð½Ð° Ð¿Ð¾Ð»Ð±Ð°ÑˆÐºÐ¸.',
    'Ð Ð²Ñ‹ ÐºÐ°Ðº Ñ‡ÐµÐ»Ð¾Ð²ÐµÐº â€” Ð´ÐµÑ€ÑŒÐ¼Ð¾! Ð˜Ð·Ð²Ð¸Ð½Ð¸Ñ‚Ðµ. (Ðº Ð¡Ð¸Ð»ÑŒÐ²ÐµÑÑ‚Ñ€Ñƒ ÐÐ½Ð´Ñ€ÐµÐµÐ²Ð¸Ñ‡Ñƒ)',
    'Ð¨Ð½ÑÐ³Ð° ÑˆÐ½ÑÐ¶Ð½Ð°Ñ, Ð¶Ð¸Ð·Ð½ÑŒ Ð¾Ð±Ñ‰Ð°Ð¶Ð½Ð°Ñ: Ð±ÐµÑÐ¿Ð¾Ð½Ñ‚Ð¾Ð²Ð°Ñ, Ð½Ð¾ ÐºÐ°Ð¹Ñ„Ð¾Ð²Ð°Ñ!',
    'Ð“Ð¾ÑˆÐ°Ð½, Ñ‚Ñ‹ Ð¿ÑŒÑ‘ÑˆÑŒ ÑÐ»Ð¸ÑˆÐºÐ¾Ð¼ Ð¼Ð½Ð¾Ð³Ð¾ ÐºÐ¾Ñ„Ðµ. Ð­Ñ‚Ð¾ Ð¾Ñ‡ÐµÐ½ÑŒ Ð²Ñ€ÐµÐ´Ð½Ð¾, Ð¿Ð¾Ñ‚Ð¾Ð¼Ñƒ Ñ‡Ñ‚Ð¾ Ð² ÐºÐ¾Ñ„Ðµ ÑÐ¾Ð´ÐµÑ€Ð¶Ð¸Ñ‚ÑÑ ÐºÐ¾ÐºÐ°Ð¸Ð½.',
    'Ð ÐµÑ‰Ñ‘ Ñ Ñ…Ð¾Ñ‡Ñƒ ÐºÑ€Ð¾ÑÑÐ¾Ð²ÐºÐ¸, ÐºÐ°Ðº Ñƒ Ð§Ð°ÐºÐ° ÐÐ¾Ñ€Ñ€Ð¸ÑÐ°, 43 Ð¸ 44-Ð³Ð¾ Ñ€Ð°Ð·Ð¼ÐµÑ€Ð°, Ð½Ñƒ, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð·Ð¸Ð¼Ð¾Ð¹ Ñ Ñ‚Ñ‘Ð¿Ð»Ñ‹Ð¼ Ð½Ð¾ÑÐºÐ¾Ð¼ Ð½Ð¾ÑÐ¸Ñ‚ÑŒ. Ð ÐµÑ‰Ñ‘ Ð·ÑƒÐ± Ð·Ð¾Ð»Ð¾Ñ‚Ð¾Ð¹, ÐºÐ°Ðº Ð² Ñ„Ð¸Ð»ÑŒÐ¼Ðµ Â«ÐšÑ€Ð¾Ð²Ð°Ð²Ñ‹Ð¹ ÑÐ¿Ð¾Ñ€Ñ‚Â». ÐšÑ€ÑƒÑ‚Ð¾?',
    'Ð Ñƒ Ð½Ð°Ñ Ð² ÐºÐ¾Ð¼Ð½Ð°Ñ‚Ðµ Ð½Ð¸ÐºÐ¾Ð³Ð¾ Ð½ÐµÑ‚, Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð“ÐµÑ€Ð¼Ð°Ð½. ÐÐ¾ Ð²Ñ‹ Ð½Ðµ Ð±Ð¾Ð¹Ñ‚ÐµÑÑŒ, Ð¾Ð½ Ñ‚Ð¸Ñ…Ð¸Ð¹, Ñ ÐµÐ³Ð¾ Ð±ÑŒÑŽ.',
    'Ð¢Ð°Ð¼ Ð¾Ð»Ð¸Ð³Ð°Ñ€Ñ… Ð¾Ð´Ð¸Ð½, ÐžÐ½Ð°Ð½ÑƒÑâ€¦ ÐžÐ½Ð°Ð½Ð¸Ñâ€¦',
    'ÐšÑ€ÑƒÑ‚ÑÐº!',
    'ÐŸÐ¸Ð²Ð¾ Ñ…Ð¾Ñ€Ð¾ÑˆÐµÐµ, Ð° Ñ…Ð¾Ð·ÑÐµÐ²Ð° â€” ÐºÐ¾Ð·Ð»Ñ‹!',
    'Ð¡Ð¸Ð¶Ñƒ Ð¸ Ð´ÑƒÐ´ÑŽ, Ð° Ð²ÐµÐ»Ð¾ÑÐ¸Ð¿ÐµÐ´ â€” Ñ‚ÑŽÑ‚ÑŽ!',
    'Ð§Ñ‘ ÑÐ¸Ð´Ð¸Ð¼, Ñ‡Ñ‘ Ð½Ðµ Ð´ÑƒÐ´Ð¸Ð¼?',
    'ÐŸÐµÐ»ÑŒÐ¼ÐµÑˆÐ¸ Ñ ÐºÐµÑ‚Ñ‡ÐµÐ½ÐµÐ·Ð¾Ð¼ â€” ÑÑ‚Ð¾ Ð²Ð°Ñ‰Ðµ!',
    'Ð’Ð¸Ð¶Ñƒ, Ð´Ð¾Ð¼ Ð½Ð°Ñˆ Ð±Ñ€ÐµÐ²ÐµÐ½Ñ‡Ð°Ñ‚Ñ‹Ð¹, Ð° Ð½Ð° Ð¿Ð¾Ñ€Ð¾Ð³Ðµ Ð´ÐµÐ´, Ð¦Ð°Ñ€ÑÑ‚Ð²Ð¸Ðµ ÐµÐ¼Ñƒ ÐÐµÐ±ÐµÑÐ½Ð¾Ðµ, ÐºÐ°Ñ€Ð°ÑÐµÐ¹ ÑÐ¾Ð»ÑŒÑŽ Ð½Ð°Ñ‚Ð¸Ñ€Ð°ÐµÑ‚, Ð¦Ð°Ñ€ÑÑ‚Ð²Ð¸Ðµ Ð¸Ð¼ ÐÐµÐ±ÐµÑÐ½Ð¾Ðµ.',
    'Ð£ Ð¼ÐµÐ½Ñ Ð²Ð¾Ñ‚ Ñ‚Ñ‘Ñ‚ÐºÑƒ Ð² ÐšÑƒÑ€Ð³Ð°Ð½Ðµ Ñ‡ÑƒÑ‚ÑŒ Ð½Ð° ÐœÐ°ÑÐ»ÐµÐ½Ð¸Ñ†Ñƒ Ð½Ðµ ÑÐ¾Ð¶Ð³Ð»Ð¸. Ð Ñ‡Ñ‘? Ð’ÑÐµ Ð¿ÐµÑ€ÐµÐ¿Ð¸Ð»Ð¸ÑÑŒ, Ð° Ð¾Ð½Ð° Ð¿Ð¾ÑˆÐ»Ð° Ñ Ñ‡ÑƒÑ‡ÐµÐ»Ð¾Ð¼ Ñ„Ð¾Ñ‚Ð¾Ð³Ñ€Ð°Ñ„Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒÑÑ.',
    'Ð£ Ð¼ÐµÐ½Ñ ÑÐ²Ð¾Ñ ÐºÐ¾Ð¼Ð½Ð°Ñ‚Ð° Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð´Ð²Ð° Ð³Ð¾Ð´Ð° Ð±Ñ‹Ð»Ð°, Ð¿Ð¾ÐºÐ° Ð±Ñ€Ð°Ñ‚ ÑÐ¸Ð´ÐµÐ».',
    'Ð¯ Ñ‚Ðµ Ñ‰Ð°Ñ Ð¶Ð±Ð°Ð½ Ð¿Ñ€Ð¾Ð»Ð¾Ð¼Ð»ÑŽ! (Ð² Ð¾Ð±Ñ€Ð°Ñ‰ÐµÐ½Ð¸Ð¸ Ðº Ð¡ÑƒÑÐ»Ð¾Ð¿Ð°Ñ€Ð¾Ð²Ñƒ)',
    'Ð¢Ñ‹ Ñ‡Ñ‘, Ð½Ðµ Ð·Ð½Ð°ÐµÑˆÑŒ ÑÐµÐºÑ€ÐµÑ‚ ÑÐµÐºÑ€ÐµÑ‚Ð°?! Ð£Ð·Ð½Ð°Ð» Ð¾Ð´Ð¸Ð½ â€” ÑƒÐ·Ð½Ð°ÑŽÑ‚ Ð²ÑÐµ!',
    'ÐžÐ½ Ð¼ÐµÐ½Ñ ÑÑ‚Ð°Ñ€Ð¸ÐºÐ¾Ð¼ Ð½Ð°Ð·Ñ‹Ð²Ð°ÐµÑ‚!',
    'Ð‘Ð°Ñ‚Ñ ÑÐ²Ð¾Ð¹ ÑÐ°Ð¼Ð¾Ð³Ð¾Ð½ Ð½Ð°ÑÑ‚Ð°Ð¸Ð²Ð°ÐµÑ‚â€¦ Ð½Ð° ÐºÐ¾Ð½ÑÐºÐ¾Ð¼ Ð½Ð°Ð²Ð¾Ð·Ðµ.',
    'Ð•Ñ‰Ñ‘ Ñ€Ð°Ð· Ð±Ð°Ñ‚Ð¸Ð½ ÑÐ°Ð¼Ð¾Ð³Ð¾Ð½ Ð±Ð°Ð´ÑÐ³Ð¾Ð¹ Ð½Ð°Ð·Ð¾Ð²Ñ‘ÑˆÑŒ, Ñ Ñ‚Ðµ Ñ‚Ð²Ð¾ÑŽ ÐºÑƒÐ´Ñ€ÑÐ²ÑƒÑŽ ÐºÑƒÐºÑƒÑˆÐºÑƒ ÑÐ½ÐµÑÑƒ!',
    'Ð­Ñ‚Ð¾ Ñ‚Ð²Ð¾Ñ Ñ‚Ñ‘Ð»ÐºÐ° â€” Ñ‚ÐµÐ»ÐºÐ°, Ð° Ð¼Ð¾Ñ Ñ‚ÐµÐ»ÐºÐ° â€” Ð´ÐµÐ²ÑƒÑˆÐºÐ°!',
    'Ð”Ð¾ Ñ‡ÐµÐ³Ð¾ Ð´Ð¾ÑˆÐµÐ» Ð¿Ñ€Ð¾Ð³Ñ€ÐµÑÑ â€” Ð¿Ð¾ÑÐ²Ð¸Ð»ÑÑ ÐºÐµÑ‚Ñ‡Ð¾Ð½ÐµÐ·!',
    'Ð¯ Ð¾Ð¿Ð¾Ð·Ð´Ð°Ð», Ð¿Ð¾Ñ‚Ð¾Ð¼Ñƒ Ñ‡Ñ‚Ð¾ Ð²Ð¾ ÑÐ½Ðµ Ð´ÑƒÐ¼Ð°Ð», Ñ‡Ñ‚Ð¾ Ð½Ðµ ÑÐ¿Ð»ÑŽ.',
    'ÐšÐ°Ðº ÑÑ‚Ð¾ Ð¾Ð½Ð¸ Ñ‚Ð°Ðº Ð²ÑÑ‚Ñ€ÐµÑ‡Ð°ÑŽÑ‚ÑÑ, ÐµÑÐ»Ð¸ Ð¾Ð½Ð¸ Ð½Ðµ Ð²ÑÑ‚Ñ€ÐµÑ‡Ð°ÑŽÑ‚ÑÑ?!',
    'ÐÑƒ ÑÑ‚Ð¾... Ð¯ Ñ‚Ð°Ðº Ð´Ð°Ð»ÐµÐºÐ¾ Ð½Ðµ Ð¿Ñ€Ð¾Ð´ÑƒÐ¼Ñ‹Ð²Ð°Ð».',
    'Ð•Ñ‰Ñ‘ Ñ€Ð°Ð· Ñ‚Ð°Ðº ÑÐ´ÐµÐ»Ð°ÐµÑˆÑŒ, Ð½Ð¸ÐºÐ¾Ð³Ð´Ð° Ð±Ð¾Ð»ÑŒÑˆÐµ Ñ‚Ð°Ðº Ð´ÐµÐ»Ð°Ñ‚ÑŒ Ð½Ðµ ÑÐ¼Ð¾Ð¶ÐµÑˆÑŒ!',
    'Ð¯ Ð¿Ñ€Ð¸Ð´ÑƒÐ¼Ð°Ð», Ñ‡Ñ‚Ð¾ Ð½Ð°Ð´Ð¾ ÑÐ´ÐµÐ»Ð°Ñ‚ÑŒ, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ñ„Ð¸Ð»Ð¾ÑÐ¾Ñ„Ð¸Ñ Ð¾Ð±Ñ€Ð°Ñ‚Ð½Ð¾ Ð½Ðµ Ð²Ñ‹Ñ‚ÐµÐºÐ»Ð°!',
    'Ð’Ñ€ÐµÐ¼Ñ Ð¿Ð¾Ð´Ð¾Ð±Ð½Ð¾ Ð¿ÐµÑÑ‡Ð¸Ð½ÐºÐ°Ð¼, ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ðµ ÑÑ‹Ð¿ÑÑ‚ÑÑ ÑÐºÐ²Ð¾Ð·ÑŒ Ð¿Ð°Ð»ÑŒÑ†Ñ‹ Ð¶Ð¸Ð·Ð½Ð¸, Ð¿ÐµÑ€ÐµÑÑ‡Ð¸Ñ‚Ð°Ñ‚ÑŒ Ð¸Ñ… Ð½ÐµÐ²Ð¾Ð·Ð¼Ð¾Ð¶Ð½Ð¾, Ð½Ð¾ ÐºÐ¾Ð³Ð´Ð°-Ð½Ð¸Ð±ÑƒÐ´ÑŒ Ð»Ð°Ð´Ð¾Ð½ÑŒ ÑÐ¾Ð·Ð½Ð°Ð½Ð¸Ñ Ð±ÑƒÐ´ÐµÑ‚ Ð¿ÑƒÑÑ‚Ð°, Ð¿ÐµÑÑ‡Ð¸Ð½ÐºÐ¸ ÑÐ¾Ð»ÑŒÑŽÑ‚ÑÑ Ð´Ñ€ÑƒÐ³ Ñ Ð´Ñ€ÑƒÐ³Ð¾Ð¼ Ð¸ Ð¾Ð±Ñ€Ð°Ð·ÑƒÑŽÑ‚ Ð²ÐµÑ‡Ð½Ð¾ÑÑ‚ÑŒ.',
];

const textsOfSasha = [
    'ÐŸÐ°Ð¿Ð°, Ð½Ðµ Ð»ÐµÐ·ÑŒ Ð² Ð¼Ð¾ÑŽ Ð¶Ð¸Ð·Ð½ÑŒ!',
    'ÐÑƒ, ÐŸÐÐŸÐ!',
    'Ð˜ Ð½Ðµ Ð½ÑƒÐ¶Ð½Ñ‹ Ð¼Ð½Ðµ Ñ‚Ð²Ð¾Ð¸ Ð´ÐµÐ½ÑŒÐ³Ð¸! Ð¯ Ð°ÑÑ‚Ñ€Ð¾Ð½Ð¾Ð¼!',
    'ÐŸÐ°Ð¿Ð°, Ñ‡Ñ‚Ð¾ Ñ‚Ñ‹ ÑÑŽÐ´Ð° ÐºÐ°Ðº Ð½Ð° Ñ€Ð°Ð±Ð¾Ñ‚Ñƒ Ñ…Ð¾Ð´Ð¸ÑˆÑŒ?',
    'ÐžÐ½Ð° Ð´Ð°Ð¶Ðµ ÐºÐ¾Ð³Ð´Ð° ÐºÐ¾Ð»Ð±Ð°ÑÑƒ Ñ€ÐµÐ¶ÐµÑ‚, Ð¾Ð½Ð° Ñƒ Ð½ÐµÑ‘ Ð½ÐµÐ²ÐºÑƒÑÐ½Ð°Ñ Ð¿Ð¾Ð»ÑƒÑ‡Ð°ÐµÑ‚ÑÑ.',
    'Ð—Ð´ÐµÑÑŒ Ð²ÑÐµ Ñ‚Ð°Ðº Ñ€Ð°ÑÑÐ»Ð°Ð±Ð»ÑÑŽÑ‚ÑÑ, Ñ‡Ñ‚Ð¾ Ñ Ð½Ð°Ñ‡Ð¸Ð½Ð°ÑŽ Ð½Ð°Ð¿Ñ€ÑÐ³Ð°Ñ‚ÑŒÑÑ!',
    'ÐšÐ¾Ð³Ð´Ð° Ð¼ÑƒÐ¶Ñ‡Ð¸Ð½Ð° Ð½Ð°Ð´ÐµÐ²Ð°ÐµÑ‚ Ð¾Ð±Ñ€ÑƒÑ‡Ð°Ð»ÑŒÐ½Ð¾Ðµ ÐºÐ¾Ð»ÑŒÑ†Ð¾, Ð¾Ð½ ÑÑ€Ð°Ð·Ñƒ Ð¶Ðµ Ð¿Ñ€ÐµÐ²Ñ€Ð°Ñ‰Ð°ÐµÑ‚ÑÑ Ð¸Ð· ÑÐ¸Ð¼Ð¿Ð°Ñ‚Ð¸Ñ‡Ð½Ð¾Ð³Ð¾ Ð¿Ð°Ñ€Ð½Ñ Ð² ÐºÐ°ÐºÐ¾Ð³Ð¾-Ñ‚Ð¾ Ð¶ÐµÐ½Ð°Ñ‚Ð¾Ð³Ð¾ Ð¼ÑƒÐ¶Ð¸ÐºÐ°.',
];

const textsOfSilvester = [
    'Ð¢Ñ‹ ÑÐ¿ÐµÑ€Ð²Ð° Ð¼Ð¾Ð·Ð³Ð¸ ÑÐµÐ±Ðµ Ð½Ð¾Ð²Ñ‹Ðµ ÐºÑƒÐ¿Ð¸!',
    'ÐœÐµÐ½Ñ Ð´Ð°Ð¶Ðµ Ñ„Ð°ÐºÑ‚ Ñ‚Ð²Ð¾ÐµÐ³Ð¾ ÑÑƒÑ‰ÐµÑÑ‚Ð²Ð¾Ð²Ð°Ð½Ð¸Ñ Ð±ÐµÑÐ¸Ñ‚. (Ð² Ð¾Ð±Ñ€Ð°Ñ‰ÐµÐ½Ð¸Ð¸ Ðº ÐšÑƒÐ·Ðµ)',
    'ÐÑ‚Ð»ÐµÑ‚.',
    'ÐÑƒÐ¶Ð½Ñ‹ Ð´ÐµÐ½ÑŒÐ³Ð¸? Ð¢Ð°Ðº Ð½Ð°! Ð’Ð¾Ð·ÑŒÐ¼Ð¸ Ñƒ Ð¼ÐµÐ½Ñ! (Ð² Ð¾Ð±Ñ€Ð°Ñ‰ÐµÐ½Ð¸Ð¸ Ðº Ð¡Ð°ÑˆÐµ)',
    'ÐŸÑ€Ð¸Ð²ÐµÑ‚, Ñ‚ÑƒÐ¿Ð¾Ñ€ÐµÐ·! (Ð² Ð¾Ð±Ñ€Ð°Ñ‰ÐµÐ½Ð¸Ð¸ Ðº ÐšÑƒÐ·Ðµ)',
    'ÐŸÑ€Ð¸Ð²ÐµÑ‚, ÐºÐ°Ñ‡Ð¾Ðº! (Ð² Ð¾Ð±Ñ€Ð°Ñ‰ÐµÐ½Ð¸Ð¸ Ðº ÐšÑƒÐ·Ðµ)',
    'Ð’Ñ‹ Ñ…Ð¾Ñ‚Ð¸Ñ‚Ðµ, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ñ ÑÐºÐ°Ð·Ð°Ð» ÑÐ²Ð¾ÐµÐ¼Ñƒ Ð¾Ñ…Ñ€Ð°Ð½Ð½Ð¸ÐºÑƒ Ð½Ð°Ð²Ð°Ð»ÑÑ‚ÑŒ Ð¾Ñ…Ñ€Ð°Ð½Ð½Ð¸ÐºÑƒ ÐœÐ°Ñ€Ñ‚Ñ‹Ð½Ð¾Ð²Ð°?â€¦ Ð“ÐµÐ½Ð°, ÑÑ€Ð¾Ñ‡Ð½Ð¾ ÐºÐ¾ Ð¼Ð½Ðµ!',
    'Ð¡Ð»Ñ‹ÑˆÑŒ, Ð¸Ð´Ð¸ Ð¸ Ð´ÐµÐ³Ñ€Ð°Ð´Ð¸Ñ€ÑƒÐ¹ Ð¿Ð¾Ð´Ð°Ð»ÑŒÑˆÐµ Ð¾Ñ‚ Ð¼Ð¾ÐµÐ³Ð¾ ÑÑ‹Ð½Ð°!',
    'ÐÑƒ, Ñ‡Ñ‚Ð¾ Ñ‚Ñ‹ ÐºÐ¾Ð¿Ð°ÐµÑˆÑŒÑÑ, ÐºÐ°Ðº Ð²Ð¾ÑÑŒÐ¼Ð¸ÐºÐ»Ð°ÑÑÐ½Ð¸Ðº Ñ Ð±ÑŽÑÑ‚Ð³Ð°Ð»ÑŒÑ‚ÐµÑ€Ð¾Ð¼!',
    'Ð§Ðµ Ñ€Ð¶ÐµÑ‚Ðµ, Ð¾Ð±Ð¾Ñ€Ð¼Ð¾Ñ‚Ñ‹?',
    'Ð¡Ð°ÑˆÐ°, Ð¾Ñ€Ð³Ð°Ð½Ð¸Ð·Ð¼ ÑÑ‚Ð¾ Ð½Ðµ ÐºÐ°Ð·Ð°Ñ…ÑÐºÐ¸Ðµ Ð¿Ð°Ñ€Ñ‚Ð½Ñ‘Ñ€Ñ‹, ÐµÐ³Ð¾ Ð½Ðµ Ð¾Ð±Ð¼Ð°Ð½ÐµÑˆÑŒ.',
    'ÐÐµ Ñ€Ð¾Ð²Ð½ÑÐ¹ÑÑ Ð½Ð° Ð¼ÐµÐ½Ñ! Ð¯ ÑƒÐ¶Ðµ Ð²ÑÐµ ÑÐ´ÐµÐ»Ð°Ð»: Ð´Ð¾Ð¼ Ð¿Ð¾ÑÑ‚Ñ€Ð¾Ð¸Ð», ÑÑ‹Ð½Ð° Ð²Ñ‹Ñ€Ð°ÑÑ‚Ð¸Ð», ÐºÐ¾Ð³Ð¾ Ð½Ð°Ð´Ð¾ Ð¿Ð¾ÑÐ°Ð´Ð¸Ð»!',
    'Ð¡Ð»ÐµÐ·Ñ‹, ÑÐ¾Ð¿Ð»Ð¸, ÑÐ»ÑŽÐ½Ð¸ â€” Ð¶ÐµÐ½ÑÐºÐ¸Ðµ Ð¶Ð¸Ð´ÐºÐ¾ÑÑ‚Ð¸, Ð° Ð¼ÑƒÐ¶ÑÐºÐ¸Ðµ â€” ÐºÐ¾Ð½ÑŒÑÐº, Ð²Ð¸ÑÐºÐ°Ñ€ÑŒ Ð¸ Ð½Ð° ÑƒÑ‚Ñ€Ð¾ Ð¼Ð¸Ð½ÐµÑ€Ð°Ð»ÐºÐ°.',
    'ÐŸÐ¾ÑÐ»Ðµ Ñ‚Ð¾Ð³Ð¾, Ñ‡Ñ‚Ð¾ Ð¿Ñ€Ð¾Ð¸Ð·Ð¾ÑˆÐ»Ð¾, ÐºÑ€Ð¸Ð·Ð¸Ñ Ð¾Ð±ÑÐ·Ð°Ð½ Ð½Ð° Ð¼Ð½Ðµ Ð¶ÐµÐ½Ð¸Ñ‚ÑŒÑÑ.',
    'Ð¯ Ð²Ð°Ð¼ Ñ‡Ñ‚Ð¾, Ð¿Ð°Ð¼ÑÑ‚Ð½Ð¸Ðº, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð¾ÐºÐ¾Ð»Ð¾ Ð¼ÐµÐ½Ñ Ñ†ÐµÐ»Ð¾Ð²Ð°Ñ‚ÑŒÑÑ?',
    'Ð£ Ñ‚ÐµÐ±Ñ Ð½ÐµÑ‚ Ð´ÐµÐ½ÐµÐ³? Ð­Ñ‚Ð¾ Ñƒ Ð¼ÐµÐ½Ñ Ð½ÐµÑ‚ Ð´ÐµÐ½ÐµÐ³! Ð˜ Ñ‚Ñ‹ Ð´Ð°Ð¶Ðµ Ð½Ðµ Ð¿Ñ€ÐµÐ´ÑÑ‚Ð°Ð²Ð»ÑÐµÑˆÑŒ, ÑÐºÐ¾Ð»ÑŒÐºÐ¾ Ñƒ Ð¼ÐµÐ½Ñ Ð½ÐµÑ‚ Ð´ÐµÐ½ÐµÐ³!',
];

const texts = {
    'ÐšÑƒÐ·Ñ': textsOfKuzya,
    'Ð¡Ð°ÑˆÐ°': textsOfSasha,
    'Ð¡Ð¸Ð»ÑŒÐ²ÐµÑÑ‚Ñ€ ÐÐ½Ð´Ñ€ÐµÐµÐ²Ð¸Ñ‡': textsOfSilvester,
};

const getMind = () => {
    const ks = Object.keys(texts);
    const kks = [];
    for (const k of ks) {
        for (let i = 0; i < texts[k].length; i++) {
            kks.push(k);
        }
    }
    const k = kks[Math.floor(Math.random() * kks.length)];
    const ts = texts[k];

    return [k, ts[Math.floor(Math.random() * ts.length)]];
};

const sendToChannel = async () => {
    sendMessage(chatId, ...(await getMessage()));
};

const getDiffs = () => {
    const d1 = moment().add(1, 'year').startOf('year');
    const d2 = moment();
    const diffMinutes = d1.diff(d2, 'minutes');
    const diffDays = d1.diff(d2, 'days') + 1;
    return [diffMinutes, diffDays];
};

const getMessages = (who, what) => {
    const [diffMinutes, diffDays] = getDiffs();
    return [
        'Ð”Ð¾ ÐÐ¾Ð²Ð¾Ð³Ð¾ Ð“Ð¾Ð´Ð°',
        `${diffMinutes} ${declOfNum(diffMinutes, ['Ð¼Ð¸Ð½ÑƒÑ‚Ð°', 'Ð¼Ð¸Ð½ÑƒÑ‚Ñ‹', 'Ð¼Ð¸Ð½ÑƒÑ‚'])}`,
        `ðŸ—“ ${diffDays} ${declOfNum(diffDays, ['Ð´ÐµÐ½ÑŒ', 'Ð´Ð½ÐµÐ¹', 'Ð´Ð½Ñ'])}`,
        `ðŸ’­ ${what}`,
    ];
};

const getMessage = async () => {
    const [who, what] = getMind();
    const [pc1, pc2, ...rest] = getMessages(who, what);
    const photoPath = await makePhoto(pc1, pc2, who);

    console.log({photoPath});

    return [
        photoPath,
        rest.join('\n'),
    ];
};

const makePhoto = (pc1, pc2, who) => {
    return new Promise(resolve => {
        let base = 'bbbase.png';
        if (who === 'Ð¡Ð°ÑˆÐ°') {
            base = 'bbsasha.png';
        }
        if (who === 'Ð¡Ð¸Ð»ÑŒÐ²ÐµÑÑ‚Ñ€ ÐÐ½Ð´Ñ€ÐµÐµÐ²Ð¸Ñ‡') {
            base = 'bbsil.png';
        }
        gm(path.resolve(__dirname, base))
            .noProfile()
            .font(path.resolve(__dirname, 'FreeSans.ttf'))
            .fill('#000000')
            .fontSize(30)
            .drawText(140, -40, pc1, 'center')
            .fill('#ff0000')
            .fontSize(46)
            .drawText(140, 10, pc2, 'center')
            .write(path.resolve(__dirname, 'bbres.png'), (e) => {
                if (e) {
                    console.log('ERROR');
                    console.log(e);
                }
                resolve(path.resolve(__dirname, 'bbres.png'));
            });
    });
};

const sendMessage = (chatId, photo, message) => {
    bot.telegram.sendPhoto(chatId, {source: photo}, {caption: message});
};

bot.on('text', async ctx => {
    sendMessage(ctx.message.chat.id, ...(await getMessage()));
});

bot.launch();

const job = new CronJob('0 0 11,20 * * *', function () {
    console.log('WOW1');
    sendToChannel();
}, null, true, 'Europe/Moscow');

job.start();

const requestHandler = (request, response) => {
    console.log(request.url)
    response.end('Hello Node.js Server!')
}

const server = http.createServer(requestHandler);
server.listen(Number(process.env.PORT) || 3000, (err) => {
    if (err) {
        return console.log('something bad happened', err)
    }
    console.log(`server is listening on ${Number(process.env.PORT) || 3000}`)
})


process.once('SIGINT', () => {
    bot.stop('SIGINT');
    job.stop();
});
process.once('SIGTERM', () => {
    bot.stop('SIGTERM');
    job.stop();
});
